{% extends "base.html" %}

{% load static %}

{% block jquery %}

  function updateCart(item, qty, del){
    var url = "{% url 'create_cart' %}" + '?' + 'item=' + item + '&qty=' + qty;
    if(del === true){
      url += '&delete=y';
    }
    return $.ajax({
      url: url,
      type: 'GET',
    }).promise();
  }

  $('.update-cart').on('input', function(){
    var qty = $(this).val();
    if(!qty){
    return ;
    }
    var item = $(this).data('item-id');
    var self = $(this);
    updateCart(item, qty).then(function(response){
      console.log(response);
      $('#cart-count-badge').text(response.cart_count);
      self.parent().next().text('Rs '+ response.item_total);
      $('#cart-price').text('Rs ' + response.cart_price);
    });
  });

  $('.remove-item').click(function(event){
    console.log($(this));
    var item = $(this).data('item-id');
    updateCart(item, 1, true).then(function(response){
      window.location.reload();
    });
  });
{% endblock %}


{% block content %}

<table class="table">
  <tr>
    <td>Name</td>
    <td>Quantity</td>
    <td>Item Price</td>
    <td>Item Total</td>
    <td>Remove</td>
  </tr>
{% for cart_item in object.cartitem_set.all %}
  <tr>
<!--     <td><img src="{% static 'images/shopping_cart.jpg' %}"></td>
 -->    <td>{{cart_item.item_name}}</td>
    <td><input class="update-cart" data-item-id="{{cart_item.item.id}}" type="number" name="qty" min="1" value="{{cart_item.quantity}}"></td>
    <td class="item-price">Ugx {{cart_item.item_total}}</td>
    <td class="item-price"> Ugx {{object.cart_price}}</td>
    <td class="item-price"><a href="javascript:void(0)" data-item-id="{{cart_item.item.id}}" class="remove-item"><i class="fa fa-trash" style="font-size: 20px; color: red; text-align: center;"></i></a></td>
  </tr>
{% endfor %}
  <tr align="right" class="right-align">
    <td class="button cart_button_checkout"><a href="/">Continue Shopping</a></td>
    <td class="button cart_button_checkout"><a href="{% url 'cart_detail_pay' %}">Continue to payment</a></td>
  </tr>
</table>

{% endblock %}


       